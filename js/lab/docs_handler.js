var h=class{ele;handle;scroll_host;scroll;scroll_end;scroll_beg;resize_obs;mutate_obs;curr_height;target_height;target_pos;curr_pos;sb_distance;scroll_box_ratio;grab_diff;scroll_amount;HANDLE_MOVE;bound_handle_wheel;bound_handle_scroll;constructor(e,s=e){this.scroll_host=s,this.scroll=document.createElement("div"),this.scroll.classList.add("scroll"),this.handle=document.createElement("div"),this.handle.classList.add("scroll-handle"),this.handle.addEventListener("pointerdown",this.handle_down.bind(this)),this.handle.addEventListener("pointermove",this.handle_move.bind(this)),this.handle.addEventListener("pointerup",this.handle_up.bind(this)),this.scroll_beg=document.createElement("div"),this.scroll_beg.classList.add("scroll-beg"),this.scroll_end=document.createElement("div"),this.scroll_end.classList.add("scroll-end"),this.scroll.appendChild(this.handle),this.scroll.appendChild(this.scroll_beg),this.scroll.appendChild(this.scroll_end),this.scroll_host.appendChild(this.scroll),this.resize_obs=new ResizeObserver(this.handle_resize.bind(this)),this.mutate_obs=new MutationObserver(this.handle_resize.bind(this)),this.resize_obs.observe(s),this.bound_handle_wheel=this.handle_wheel.bind(this),this.bound_handle_scroll=this.handle_scroll.bind(this),this.scroll_amount=0,this.scroll_box_ratio=1,this.sb_distance=0,this.target_height=0,this.curr_height=0,this.curr_pos=0,this.target_pos=0,this.HANDLE_MOVE=!1,this.grab_diff=0,this.set_target(e)}set_target(e){this.ele&&(this.ele.removeEventListener("wheel",this.bound_handle_wheel),this.ele.removeEventListener("scroll",this.bound_handle_scroll),this.resize_obs.unobserve(this.ele),this.mutate_obs.disconnect()),this.resize_obs.observe(e),this.mutate_obs.observe(e,{subtree:!0,attributes:!0,childList:!0});for(let s of Array.from(e.children))this.resize_obs.observe(s);e.addEventListener("wheel",this.bound_handle_wheel),e.addEventListener("scroll",this.bound_handle_scroll),this.ele=e,this.handle_resize()}handle_resize(){if(this.ele){let e=this.ele.clientHeight;this.scroll_amount=this.ele.scrollHeight-e,this.scroll_box_ratio=e/this.ele.scrollHeight,this.target_height=this.scroll_box_ratio*this.scroll.clientHeight,this.target_pos=this.ele.scrollTop/this.scroll_amount*(this.scroll.clientHeight-this.target_height),this.sb_distance=this.scroll.clientHeight-this.target_height,this.sb_distance<1?this.scroll.classList.add("no-scroll"):this.scroll.classList.remove("no-scroll"),this.handle_pos_adjust(),this.handle_height_adjust(),this.handle_scrolled()}}handle_height_adjust(){if(this.curr_height!=this.target_height&&this.ele){let e=(this.target_height-this.curr_height)*.5;Math.abs(e)>.01?(this.curr_height+=e,setTimeout(this.handle_height_adjust.bind(this),10)):this.curr_height=this.target_height,this.curr_height+this.target_pos>this.ele.scrollHeight&&(this.curr_height-=this.curr_height+this.target_pos-this.ele.scrollHeight),this.handle.style.height=this.curr_height+"px"}}handle_pos_adjust(){if(this.curr_pos!=this.target_pos){let e=(this.target_pos-this.curr_pos)*.5;Math.abs(e)>1e19?(this.curr_pos+=e,setTimeout(this.handle_pos_adjust.bind(this),10)):this.curr_pos=this.target_pos,this.handle.style.top=this.curr_pos+"px"}}set_handle_pos_diff(e){this.set_handle_pos(this.target_pos+e)}set_handle_pos(e){if(this.ele){this.target_pos=Math.max(Math.min(e,this.sb_distance),0),this.handle_pos_adjust(),this.handle_scrolled();let s=this.target_pos/this.sb_distance;this.ele.scrollTop=this.scroll_amount*s}}handle_scrolled(){}handle_scroll(e){this.HANDLE_MOVE||this.handle_resize()}handle_move(e){if(this.HANDLE_MOVE){let s=e.clientY-_(this.scroll)+this.grab_diff;return this.set_handle_pos(s),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),!1}}handle_up(e){this.handle.releasePointerCapture(e.pointerId),this.HANDLE_MOVE=!1,e.preventDefault(),e.stopPropagation()}handle_down(e){this.handle.setPointerCapture(e.pointerId),this.grab_diff=-(e.clientY-_(this.scroll))+this.target_pos,this.HANDLE_MOVE=!0}handle_wheel(e){this.set_handle_pos_diff(Math.sign(e.deltaY)*50*this.scroll_box_ratio)}};function _(t){let e=0;for(;t;)e+=t.offsetTop,t=t.parentElement;return e}function c(...t){console.log(...t)}var b="lab-data",v="lab-input";function u(t,e=window){e.sessionStorage.setItem(b,t)}function a(t,e=window){e.sessionStorage.setItem(v,t)}function p(t,e=document,s=window){let i=t.dataset.id;if(i){console.log(i);let n=null;(n=e.getElementById(i+"-parser"))?a(n.innerText,s):a(""),(n=e.getElementById(i))&&u(n.innerText,s)}}function T(t,e){if(t.tagName=="IFRAME"){let s=new h(t,e),i=document.location.hash;if(i.slice(0,6)=="#page:"){let n=i.slice(6),l=atob(n);t.src=l,e.classList.add("loading"),e.classList.add("active")}c("Configuring docs integration"),t.addEventListener("load",n=>{let l=t.contentDocument,g=t.contentWindow;if(l!=null&&g!=null){let d=l.documentElement;l.body.classList.add("lab-iframe"),d.style.overflow="hidden",s.set_target(d);for(let o of Array.from(l.getElementsByTagName("a")))o.classList.contains("lab-candidate")?o.addEventListener("click",r=>{let m=t.contentWindow;return p(r.target,l,m),r.preventDefault(),!1}):o.addEventListener("click",r=>(r.preventDefault(),!1));e.classList.remove("loading")}})}else alert("Docs frame not correctly connected, cannot integrate docs")}window.lab_anchor_click=t=>{p(t)};export{T as default,p as setData};
